(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&a(c)}).observe(document,{childList:!0,subtree:!0});function t(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(s){if(s.ep)return;s.ep=!0;const o=t(s);fetch(s.href,o)}})();class K{constructor(e=1500){this.loader=document.querySelector(".page-loader"),this.loaderImg=this.loader.querySelector("img"),this.minLoadTime=e,this.isLoaded=!1,this.loaderImages=["./images/loader/Drowned-thrall-explode-optimized.webp","./images/loader/Flag_walk.webp","./images/loader/Graverobber_walk.webp","./images/loader/Hellion_walk.webp","./images/loader/Houndmaster_walk.webp","./images/loader/Jester_walk.webp"],this.setRandomLoaderImage(),this.initPageLoad()}setRandomLoaderImage(){const e=Math.floor(Math.random()*this.loaderImages.length),t=this.loaderImages[e];this.loaderImg.src=t}initPageLoad(){const e=()=>{document.readyState==="complete"&&setTimeout(()=>{this.hideLoader()},this.minLoadTime)};document.readyState==="complete"?e():window.addEventListener("load",e)}hideLoader(){this.isLoaded||(this.isLoaded=!0,document.querySelector(".homepage").classList.remove("none"),document.querySelector(".registration").classList.remove("none"),setTimeout(()=>{this.loader.classList.add("hidden"),setTimeout(()=>this.loader.remove(),500)},100))}}class R{constructor(e,t=null){this.lastData=t,this.character={name:e,imageName:"",wins:{total:0,logs:[]},loses:{total:0,logs:[]}},this.init()}init(){return this.lastData&&(this.character.name=this.lastData.name||this.character.name,this.character.imageName=this.lastData.imageName||this.character.imageName,this.character.wins=this.lastData.wins||this.character.wins,this.character.loses=this.lastData.loses||this.character.loses),this.character}getWins(){return String(this.character.wins.total)}getLoses(){return String(this.character.loses.total)}setName(e){return this.character.name=e.trim(),this}setImageName(e){this.character.imageName=e}createAvatar(e,t,a){a.innerHTML="";const s=e.filter(o=>o.name===this.character.imageName);if(t&&t.remove(),s.length===0){console.log("Character not found:",this.character.imageName);return}t=document.createElement("img"),t.className="avatar-img",t.alt="avatar",t.src=s[0].srcAvatar,a.appendChild(t)}}class M{constructor(){this.modal=document.querySelector(".modal"),this.modalWindow=document.querySelector(".modal__window"),this.modalTitle=document.querySelector(".modal__title"),this.modalContent=document.querySelector(".modal__content"),this.modalImage=document.querySelector(".modal__img img"),this.modalButton=document.querySelector(".modal__button"),this.modalClose=document.querySelector(".modal__close")}initEvents(){this.modal.addEventListener("click",this),document.addEventListener("keydown",this),this.modalButton.addEventListener("click",this),this.modalClose.addEventListener("click",this)}handleEvent(e){if(this.isCLoseAction(e))return this.closeModal()}isCLoseAction(e){return console.log(e.type),e.target===this.modalButton||e.target===this.modal||e.key==="Escape"||e.target===this.modalClose}openModal(){this.modal.classList.remove("close"),this.modal.classList.add("block"),setTimeout(()=>{this.modal.classList.add("open")},100)}closeModal(){this.modal.classList.remove("open"),this.modal.classList.add("close"),setTimeout(()=>{this.modal.classList.remove("block")},500)}}class N extends M{constructor(e,t){super(),this.result=e,this.images=t,this.resolvePromise=null,this.initEvents()}initEvents(){super.initEvents()}handleEvent(e){if(e.target===this.modal||e.key==="Escape"||e.target===this.modalClose){this.closeModal(),this.resolvePromise&&this.resolvePromise(!1);return}if(e.target===this.modalButton){this.closeModal(),this.resolvePromise&&this.resolvePromise(!0);return}}loadContent(){return this.modalTitle.textContent=this.result?"Victory!":"Defeat!",this.modalContent.textContent=this.result?"Enemies fall before you!":"Even heroes stumble, but rise again",this.modalImage.src=this.result?this.images.win:this.images.lose,this.modalButton.textContent=this.result?"They won't stop me!":"One more round!",this.openModal(),new Promise(e=>{this.resolvePromise=e})}}class q extends M{constructor(e=null){super(),this.image="./images/Squiffy-ghast.webp",this.initEvents(),this.stringClose=e,this.resolvePromise=null}initEvents(){super.initEvents()}handleEvent(e){if(e.target===this.modal||e.key==="Escape"||e.target===this.modalClose){this.closeModal(),this.resolvePromise&&this.resolvePromise(!1);return}if(e.target===this.modalButton){this.closeModal(),this.resolvePromise&&this.resolvePromise(!0);return}}loadContent(){return this.modalTitle.textContent="Are you sure?",this.modalContent.textContent=this.stringClose?this.stringClose:"If you leave the fight… it will not haunt the records.",this.modalImage.src=this.image,this.modalButton.textContent="Yes… leave.",this.openModal(),new Promise(e=>{this.resolvePromise=e})}}new K(1500);const _=[];document.querySelector(".homepage__close");const Q=document.querySelector(".registration__btn"),L=document.querySelector(".registration__input"),p=document.querySelector(".registration__label");document.querySelector(".registration");const B=document.querySelector(".avatar"),P=document.querySelector(".character__wins"),A=document.querySelector(".character__loses");let l,H=null,n=null;const i="./images/",u={ROUT:"current_rout",PLAYER_PROFILE:"fight_game_player_profile",CURRENT_FIGHT:"fight_game_current_fight"},I={currentPage:"",currentSubPage:""},C=[{name:"crusader",srcAvatar:`${i}crusader/Crus_camp.png`,srcBase:`${i}crusader/Crusader.webp`,srcAttack:`${i}crusader/Crus_attack.webp`,srcDef:`${i}crusader/Crus_def.webp`,win:`${i}crusader/Crus_heroic.webp`,lose:`${i}crusader/Crus_dead.webp`},{name:"grave-robber",srcAvatar:`${i}grave-robber/Grave_robber_camp.png`,srcBase:`${i}grave-robber/Graverobber_combat.webp`,srcAttack:`${i}grave-robber/Grave_robber_attack.webp`,srcDef:`${i}grave-robber/Grave_robber_defend.webp`,win:`${i}grave-robber/Grave_robber_heroic.webp`,lose:`${i}grave-robber/Grave_robber_dead.webp`},{name:"hellion",srcAvatar:`${i}hellion/Hellion_camp.png`,srcBase:`${i}hellion/Hellion_combat.webp`,srcAttack:`${i}hellion/Hellion_attack.webp`,srcDef:`${i}hellion/Hellion_defend.webp`,win:`${i}hellion/Hellion_heroic.webp`,lose:`${i}hellion/Hellion_dead.webp`},{name:"houndmaster",srcAvatar:`${i}houndmaster/Houndmaster_camp.png`,srcBase:`${i}houndmaster/Houndmaster_base.webp`,srcAttack:`${i}houndmaster/Houndmaster_attack.webp`,srcDef:`${i}houndmaster/Houndmaster_defend.webp`,win:`${i}houndmaster/Houndmaster_heroic.webp`,lose:`${i}houndmaster/Houndmaster_dead.webp`},{name:"jester",srcAvatar:`${i}jester/Jester_camp.png`,srcBase:`${i}jester/Jester_base.webp`,srcAttack:`${i}jester/Jester_attack.webp`,srcDef:`${i}jester/Jester_defend.webp`,win:`${i}jester/Jester_heroic.webp`,lose:`${i}jester/Jester_dead.webp`},{name:"flagellant",srcAvatar:`${i}flagellant/Flagellant_camp.png`,srcBase:`${i}flagellant/Flag_combat.webp`,srcAttack:`${i}flagellant/Flagellant_attack.webp`,srcDef:`${i}flagellant/Flagellant_deffer.webp`,win:`${i}flagellant/Flagellant_afflicted.webp`,lose:`${i}flagellant/Flagellant_dead.webp`}];let S;const D=document.querySelector(".hero__image--attack"),O=document.querySelector(".hero__image--def"),X=[{name:"spider",srcBase:`${i}spider/Spider.webp`,srcAttack:`${i}spider/Webber_attack.webp`,srcDef:`${i}spider/Webber_def.webp`},{name:"gargoyle",srcBase:`${i}gargoyle/Gargoyle_combat.webp`,srcAttack:`${i}gargoyle/Gargoyler_attack.webp`,srcDef:`${i}gargoyle/Gargoyle_defend.webp`},{name:"gaint",srcBase:`${i}gaint/Unclean-giant_battle.webp`,srcAttack:`${i}gaint/Unclean_giant_attack.webp`,srcDef:`${i}gaint/Unclean_giant_defend.webp`}];function Z(r){const e=C.find(o=>o.name===r);if(!e)return;const t=document.querySelector(".hero__image--main img"),a=document.querySelector(".hero__image--attack img"),s=document.querySelector(".hero__image--def img");e.srcBase&&(t.src=e.srcBase),e.srcAttack&&(a.src=e.srcAttack),e.srcDef&&(s.src=e.srcDef),D.classList.add(r),O.classList.add(r)}function G(r){const e=X.find(m=>m.name===r);if(!e)return;const t=document.querySelector(".boss__image--main img"),a=document.querySelector(".boss__image--attack img"),s=document.querySelector(".boss__image--def img"),o=document.querySelector(".boss");t.src=e.srcBase,a.src=e.srcAttack,s.src=e.srcDef;const c=$.find(m=>m.name===r);let d="";if(c){switch(r){case"spider":d=`${c.displayName}: It bites not hard, but often—its fangs pierce through your armor if you linger.`;break;case"gargoyle":d=`${c.displayName}: A stony wretch, hard and cruel—you’ll chip away, praying not to die first.`;break;case"gaint":d=`${c.displayName}: It strikes with crushing force, careless of defense—you’ll need luck to survive.`;break;default:d=`${c.displayName}: Unknown enemy`}o.setAttribute("data-boss-info",d)}}class ee{constructor(){this.currentPage="registration",this.currentSubPage="main",this.init()}init(){const e=sessionStorage.getItem(u.ROUT);if(e){const a=JSON.parse(e);this.currentPage=a.currentPage,this.currentSubPage=a.currentSubPage,this.currentPage==="homepage"&&(this.showHomepage(),this.showSubPage(this.currentSubPage))}const t=sessionStorage.getItem(u.PLAYER_PROFILE);if(t){const a=JSON.parse(t);if(l=new R(a.name,a),this.currentPage==="homepage"&&(document.querySelector(".homepage__title").textContent=l.character.name,P.textContent=l.getWins(),A.textContent=l.getLoses(),l.character.imageName&&l.createAvatar(C,H,B),l.character.imageName)){const s=document.querySelector(`[name="character"][value="${l.character.imageName}"]`);s&&(s.checked=!0)}}document.addEventListener("click",a=>{if(a.target.classList.contains("homepage__main-link")){if(a.preventDefault(),this.currentSubPage==="main")return;this.showSubPage("main")}if(a.target.classList.contains("homepage__character-link")){if(a.preventDefault(),this.currentSubPage==="character")return;if(n){console.log(n),new q().loadContent().then(o=>{o&&(n=null,E(),P.textContent=l.getWins(),A.textContent=l.getLoses(),this.showSubPage("character"))});return}P.textContent=l.getWins(),A.textContent=l.getLoses(),this.showSubPage("character")}if(a.target.classList.contains("homepage__settings-link")){if(a.preventDefault(),this.currentSubPage==="settings")return;if(n){console.log(n),new q().loadContent().then(o=>{o&&(n=null,E(),P.textContent=l.getWins(),A.textContent=l.getLoses(),this.showSubPage("settings"))});return}this.showSubPage("settings")}if(a.target.classList.contains("homepage__close")){new q("If you leave… your progress will be devoured.").loadContent().then(o=>{o&&(sessionStorage.clear(),this.showRegistration(),_.pop(),B.innerHTML="",document.querySelectorAll('[name="character"]').forEach(c=>{c.checked=!1}),H=null,_.length=0,l=null,E())});return}})}showRegistration(){document.querySelector(".homepage").classList.add("off"),document.querySelector(".homepage").classList.remove("on"),this.hideAllSubPages(),this.removeActiveLinks(),setTimeout(()=>{document.querySelector(".registration").classList.remove("off"),document.querySelector(".registration").classList.add("on")},500),this.currentPage="registration"}showHomepage(){this.hideRegistrPages(),document.querySelector(".homepage").classList.add("on"),document.querySelector(".homepage").classList.remove("off"),this.showSubPage("main"),this.currentPage="homepage"}showSubPage(e){this.hideAllSubPages(),this.removeActiveLinks(),setTimeout(()=>{document.querySelector(`.homepage__${e}`).classList.remove("none")},500),setTimeout(()=>{document.querySelector(`.homepage__${e}`).classList.add("on"),document.querySelector(`.homepage__${e}-link`).classList.add("active"),this.currentSubPage=e,I.currentPage=this.currentPage,I.currentSubPage=this.currentSubPage,sessionStorage.setItem(u.ROUT,JSON.stringify(I))},100)}hideRegistrPages(){document.querySelector(".registration").classList.add("off"),document.querySelector(".registration").classList.remove("on")}hideAllSubPages(){document.querySelectorAll(".homepage__main, .homepage__character, .homepage__settings").forEach(e=>{e.classList.remove("on"),e.classList.add("off"),setTimeout(()=>{e.classList.add("none")},500)})}removeActiveLinks(){document.querySelectorAll(".homepage__menu a").forEach(e=>{e.classList.remove("active")})}}const T=new ee;let h;L.addEventListener("input",r=>{h=!1,F(r.target.value,p)});L.addEventListener("keydown",r=>{r.key==="Enter"&&(h&&J(L.value),h||(p.classList.add("error"),setTimeout(()=>{p.classList.remove("error")},300)),h=!1)});Q.addEventListener("click",()=>{h&&(J(L.value),L.value=""),h||(p.classList.add("error"),setTimeout(()=>{p.classList.remove("error")},300))});function F(r,e){const t=/^[a-zA-Z]+$/,a=r.trim();if(a.length===0){e.style.setProperty("--hint-text",'"English only"'),h=!1;return}if(!t.test(a)){e.style.setProperty("--hint-text",'"English only"'),h=!1;return}if(a.length<3){e.style.setProperty("--hint-text",'"Min 3 chars"'),h=!1;return}e.style.setProperty("--hint-text",'""'),h=!0}function J(r){if(_.filter(t=>t.character.name===r).length!==0){p.style.setProperty("--hint-text",'"Name not available"'),p.classList.add("error"),setTimeout(()=>{p.classList.remove("error")},300);return}_.push(new R(L.value)),l=_.find(t=>t.character.name===r),T.hideRegistrPages(),sessionStorage.setItem(u.PLAYER_PROFILE,JSON.stringify(l.character)),console.log(l.character,_),setTimeout(()=>{T.showHomepage(),document.querySelector(".homepage__title").textContent=l.character.name},500)}const te=document.querySelector(".character__btn"),se=document.querySelectorAll('[name="character"]'),f=document.querySelector(".homepage__btn-fight"),b=document.querySelector(".battle-wrapper"),k=document.querySelector(".battle-wrapper__start-fight");let w=!1;se.forEach(r=>{r.addEventListener("change",e=>{l.setImageName(e.target.value)})});te.addEventListener("click",()=>{l.createAvatar(C,H,B),f.classList.remove("inactive"),sessionStorage.setItem(u.PLAYER_PROFILE,JSON.stringify(l.character))});const v=document.querySelector(".settings__input"),ae=document.querySelector(".settings__btn"),re=document.querySelector(".settings__label");v.addEventListener("input",r=>{h=!1,F(r.target.value,re)});ae.addEventListener("click",()=>{h&&(l.character.name=v.value,document.querySelector(".homepage__title").textContent=l.character.name,v.value="",sessionStorage.setItem(u.PLAYER_PROFILE,JSON.stringify(l.character))),h||(p.classList.add("error"),setTimeout(()=>{p.classList.remove("error")},300)),h=!1});v.addEventListener("keydown",r=>{r.key==="Enter"&&h&&(l.character.name=v.value,document.querySelector(".homepage__title").textContent=l.character.name,v.value="",h=!1,sessionStorage.setItem(u.PLAYER_PROFILE,JSON.stringify(l.character)))});const x=document.querySelectorAll(".block"),U=document.querySelectorAll(".attack"),y=Array.from(x).map(r=>r.value),g={blockParts:[],attackParts:[]};function W(r,e,t){r.forEach(a=>{a.addEventListener("change",()=>{t.length=0,t.push(...Array.from(r).filter(s=>s.checked).map(s=>s.value)),t.length===e?r.forEach(s=>{s.checked||(s.disabled=!0,s.parentElement.classList.add("disabled"))}):r.forEach(s=>{s.disabled=!1,s.parentElement.classList.remove("disabled")}),oe()})})}W(x,2,g.blockParts);W(U,1,g.attackParts);function oe(){const r=g.attackParts.length===1,e=g.blockParts.length===2;r&&e?(w=!0,k.classList.remove("inactive")):(w=!1,k.classList.add("inactive"))}const ie=document.querySelector(".boss__image--attack"),ne=document.querySelector(".boss__image--def"),le=document.querySelector(".hero__image--attack"),ce=document.querySelector(".hero__image--def"),$=[{name:"spider",displayName:"Spider",hp:300,damage:19,critChance:.4,critMultiplier:2,attackZones:2,blockZones:1},{name:"gargoyle",displayName:"Gargoyle",hp:375,damage:30,critChance:.2,critMultiplier:1.5,attackZones:1,blockZones:3},{name:"gaint",displayName:"Giant",hp:450,damage:50,critChance:.15,critMultiplier:1.7,attackZones:1,blockZones:1}];function he(){const r=Math.floor(Math.random()*$.length);return $[r]}class j{constructor(e){this.name=e,this.maxHp=350,this.hp=350,this.damage=33,this.critChance=.2,this.critMultiplier=1.7}takeDamage(e){this.hp=Math.max(0,this.hp-e)}getHpPercentage(){return Math.floor(this.hp/this.maxHp*100)}isAlive(){return this.hp>0}}class Y{constructor(e){this.name=e.displayName,this.hp=e.hp,this.maxHp=e.hp,this.damage=e.damage,this.critChance=e.critChance,this.critMultiplier=e.critMultiplier,this.attackZones=e.attackZones,this.blockZones=e.blockZones}isAlive(){return this.hp>0}takeDamage(e){this.hp=Math.max(0,this.hp-e)}getHpPercentage(){return Math.floor(this.hp/this.maxHp*100)}generateAttackZones(){return this.shuffleZones(this.attackZones)}generateBlockZones(){return this.shuffleZones(this.blockZones)}shuffleZones(e){const t=[...y];for(let s=t.length-1;s>0;s--){const o=Math.floor(Math.random()*(s+1));[t[s],t[o]]=[t[o],t[s]]}const a=t.slice(0,e);if(e>1){for(let s=1;s<a.length;s++)if(a[s]===a[s-1]){let o=y.indexOf(a[s]);o===y.length-1?o=0:o+=1,a[s]=y[o],a[s]===a[s-1]&&(o=o===0?y.length-1:o-1,a[s]=y[o])}}return a}}class de{constructor(){this.logs=[],this.logContainer=document.querySelector(".logs-battle__list")}addHit(e,t,a,s){const o=`⚔️ <span class="log-variable">${e}</span> hits <span class="log-variable">${t}</span> in the <span class="log-variable">${a}</span> for <span class="log-variable">${s}</span> damage.`;this.addLog(o)}addBlock(e,t,a,s){const o=`🛡️ <span class="log-variable">${e}</span> blocks <span class="log-variable">${s}</span> damage to the <span class="log-variable">${a}</span> from <span class="log-variable">${t}</span>.`;this.addLog(o)}addCriticalHit(e,t,a,s,o=!1){const d=`💥 <span class="log-variable">${e}</span> lands a critical hit on <span class="log-variable">${t}</span>'s <span class="log-variable">${a}</span>, dealing <span class="log-variable">${s}</span> damage <span class="log-variable">${o?" (piercing the block)":""}</span>.`;this.addLog(d)}addRoundStart(e){const t=`🔥 Round ${e} begins!`;this.addLog(t)}addBattleStart(e,t){const a=`⚔️ Battle started! <span class="log-variable">${e}</span> vs <span class="log-variable">${t}</span>`;this.addLog(a)}addVictory(e){const t=`🏆 <span class="log-variable">${e}</span> wins the battle!`;this.addLog(t)}addDefeat(e){const t=`💀 <span class="log-variable">${e}</span> has been defeated!`;this.addLog(t)}addLog(e){this.logs.push({message:e,timestamp:Date.now()}),this.displayLog(e)}displayLog(e){const t=document.createElement("li");t.className="logs-battle__log";const a=document.createElement("span");a.className="logs-battle__log-basis",a.innerHTML=e,t.appendChild(a),this.logContainer.appendChild(t),this.logContainer.scrollTop=this.logContainer.scrollHeight}clear(){this.logs=[],this.logContainer.innerHTML=""}}class V{constructor(e,t,a,s){this.hero=e,this.boss=s,this.battleLog=new de,this.round=1,this.isGameOver=!1,this.playerAttackZone=t,this.playerBlockZones=a,this.initUI()}initUI(){this.updateHpBars(),this.battleLog.clear(),this.battleLog.addBattleStart(this.hero.name,this.boss.name)}async processTurn(){if(this.isGameOver)return;this.battleLog.addRoundStart(this.round);const e=this.boss.generateAttackZones(),t=this.boss.generateBlockZones();this.hero.isAlive()&&await this.processPlayerAttacks(t),this.boss.isAlive()&&await this.processBossAttacks(e),!this.hero.isAlive()||!this.boss.isAlive()?this.endBattle():(this.round++,this.clearSelections(),z())}async processPlayerAttacks(e){for(const t of this.playerAttackZone)this.boss.isAlive()&&(this.processAttack(this.hero,this.boss,t,e),this.updateHpBars(),await this.playAnimation([le,ne],1600))}async processBossAttacks(e){for(const t of e)if(this.hero.isAlive()&&(this.processAttack(this.boss,this.hero,t,this.playerBlockZones),this.updateHpBars(),await this.playAnimation([ie,ce],1600),!this.hero.isAlive())){this.endBattle();return}}playAnimation(e,t){return new Promise(a=>{e.forEach(s=>s.classList.add("active")),setTimeout(()=>{e.forEach(s=>s.classList.remove("active")),a()},t)})}processAttack(e,t,a,s){const o=Math.random()<e.critChance,c=s.includes(a);let d=e.damage,m=0;o?(d=Math.floor(d*e.critMultiplier),c?(m=d,t.takeDamage(m),this.battleLog.addCriticalHit(e.name,t.name,a,m,!0)):(m=d,t.takeDamage(m),this.battleLog.addCriticalHit(e.name,t.name,a,m))):c?this.battleLog.addBlock(t.name,e.name,a,d):(m=d,t.takeDamage(m),this.battleLog.addHit(e.name,t.name,a,m))}updateHpBars(){const e=document.querySelector(".hero__hp"),t=document.querySelector(".boss__hp"),a=document.querySelector(".hp-text-hero"),s=document.querySelector(".hp-text-boss"),o=this.hero.getHpPercentage(),c=this.boss.getHpPercentage();e.style.setProperty("--hp",`${o}%`),t.style.setProperty("--hp",`${c}%`),a.textContent=`${this.hero.hp}/${this.hero.maxHp}`,s.textContent=`${this.boss.hp}/${this.boss.maxHp}`}clearSelections(){document.querySelectorAll(".attack, .block").forEach(e=>{e.checked=!1,e.disabled=!1}),g.attackParts.length=0,g.blockParts.length=0}async endBattle(){this.isGameOver=!0;let e,t;document.querySelector(".character__wins").textContent=l.character.wins.total,document.querySelector(".character__loses").textContent=l.character.loses.total,this.clearSelections(),E(),n=null,fe(),this.hero.isAlive()?this.boss.isAlive()||(this.battleLog.addVictory(this.hero.name),l.character.wins.total++,e=new N(!0,S),t=await e.loadContent()):(this.battleLog.addDefeat(this.hero.name),l.character.loses.total++,e=new N(!1,S),t=await e.loadContent()),t&&f.click()}}window.addEventListener("DOMContentLoaded",()=>{sessionStorage.getItem(u.CURRENT_FIGHT)&&ue()});f.addEventListener("click",()=>{if(!l.character.imageName){f.classList.add("inactive");return}S=C.find(a=>a.name===l.character.imageName),Z(l.character.imageName);const r=he();G(r.name);const e=new Y(r),t=new j(l.character.name);n=new V(t,g.attackParts,g.blockParts,e),f.classList.add("off"),b.classList.remove("none"),setTimeout(()=>{b.classList.add("on")},100),z()});k.addEventListener("click",()=>{w&&n&&(w=!1,n.playerAttackZone=[...g.attackParts],n.playerBlockZones=[...g.blockParts],n.processTurn()),k.classList.add("inactive")});function E(){D.classList.remove(S.name),O.classList.remove(S.name),f.classList.remove("inactive"),f.classList.remove("off"),b.classList.add("off"),setTimeout(()=>{b.classList.add("none")},500),b.classList.remove("on"),g.attackParts.length=0,g.blockParts.length=0,U.forEach(r=>{r.checked=!1,r.disabled=!1,r.parentElement.classList.remove("disabled")}),x.forEach(r=>{r.checked=!1,r.disabled=!1,r.parentElement.classList.remove("disabled")}),w=!1,k.classList.add("inactive"),sessionStorage.removeItem(u.CURRENT_FIGHT),n=null}function z(){if(n){const r={hero:{name:n.hero.name,hp:n.hero.hp,maxHp:n.hero.maxHp,damage:n.hero.damage,critChance:n.hero.critChance,critMultiplier:n.hero.critMultiplier},boss:{name:n.boss.name,hp:n.boss.hp,maxHp:n.boss.maxHp,damage:n.boss.damage,critChance:n.boss.critChance,critMultiplier:n.boss.critMultiplier,attackZones:n.boss.attackZones,blockZones:n.boss.blockZones},round:n.round,isGameOver:n.isGameOver,playerAttackZone:n.playerAttackZone,playerBlockZones:n.playerBlockZones,battleLogs:n.battleLog.logs,heroImageName:l.character.imageName,bossConfig:me(n.boss.name)};sessionStorage.setItem(u.CURRENT_FIGHT,JSON.stringify(r))}}function me(r){return $.find(e=>e.displayName===r)}function ue(){const r=sessionStorage.getItem(u.CURRENT_FIGHT);if(r)try{const e=JSON.parse(r);Z(e.heroImageName),G(e.bossConfig.name),S=C.find(s=>s.name===e.heroImageName);const t=new j(e.hero.name);t.hp=e.hero.hp,t.maxHp=e.hero.maxHp,t.damage=e.hero.damage,t.critChance=e.hero.critChance,t.critMultiplier=e.hero.critMultiplier;const a=new Y(e.bossConfig);a.hp=e.boss.hp,a.maxHp=e.boss.maxHp,n=new V(t,e.playerAttackZone,e.playerBlockZones,a),n.round=e.round,n.isGameOver=e.isGameOver,n.battleLog.logs=e.battleLogs||[],ge(e.battleLogs),pe(),console.log("Битва восстановлена!")}catch(e){console.error("Ошибка при восстановлении битвы:",e),sessionStorage.removeItem(u.CURRENT_FIGHT)}}function ge(r){if(r&&r.length>0){const e=document.querySelector(".logs-battle__list");e.innerHTML="",r.forEach(t=>{n.battleLog.displayLog(t.message)})}}function pe(){f.classList.add("off"),b.classList.remove("none"),b.classList.add("on")}function fe(){sessionStorage.removeItem(u.CURRENT_FIGHT)}
