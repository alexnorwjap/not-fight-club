(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const h of o.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&a(h)}).observe(document,{childList:!0,subtree:!0});function t(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(r){if(r.ep)return;r.ep=!0;const o=t(r);fetch(r.href,o)}})();class ee{constructor(e=1500){this.loader=document.querySelector(".page-loader"),this.loaderImg=this.loader.querySelector("img"),this.minLoadTime=e,this.isLoaded=!1,this.loaderImages=["./images/loader/Drowned-thrall-explode-optimized.webp","./images/loader/Flag_walk.webp","./images/loader/Graverobber_walk.webp","./images/loader/Hellion_walk.webp","./images/loader/Houndmaster_walk.webp","./images/loader/Jester_walk.webp"],this.setRandomLoaderImage(),this.initPageLoad()}setRandomLoaderImage(){const e=Math.floor(Math.random()*this.loaderImages.length),t=this.loaderImages[e];this.loaderImg.src=t}initPageLoad(){const e=()=>{document.readyState==="complete"&&setTimeout(()=>{this.hideLoader()},this.minLoadTime)};document.readyState==="complete"?e():window.addEventListener("load",e)}hideLoader(){this.isLoaded||(this.isLoaded=!0,document.querySelector(".homepage").classList.remove("none"),document.querySelector(".registration").classList.remove("none"),setTimeout(()=>{this.loader.classList.add("hidden"),setTimeout(()=>this.loader.remove(),500)},100))}}class G{constructor(e,t=null){this.lastData=t,this.character={name:e,imageName:"",wins:{total:0,logs:[]},loses:{total:0,logs:[]}},this.init()}init(){return this.lastData&&(this.character.name=this.lastData.name||this.character.name,this.character.imageName=this.lastData.imageName||this.character.imageName,this.character.wins=this.lastData.wins||this.character.wins,this.character.loses=this.lastData.loses||this.character.loses),this.character}getWins(){return String(this.character.wins.total)}getLoses(){return String(this.character.loses.total)}setName(e){return this.character.name=e.trim(),this}setImageName(e){this.character.imageName=e}createAvatar(e,t,a){a.innerHTML="";const r=e.filter(o=>o.name===this.character.imageName);if(t&&t.remove(),r.length===0){console.log("Character not found:",this.character.imageName);return}t=document.createElement("img"),t.className="avatar-img",t.alt="avatar",t.src=r[0].srcAvatar,a.appendChild(t)}}class F{constructor(){this.modal=document.querySelector(".modal"),this.modalWindow=document.querySelector(".modal__window"),this.modalTitle=document.querySelector(".modal__title"),this.modalContent=document.querySelector(".modal__content"),this.modalImage=document.querySelector(".modal__img img"),this.modalButton=document.querySelector(".modal__button"),this.modalClose=document.querySelector(".modal__close")}initEvents(){this.modal.addEventListener("click",this),document.addEventListener("keydown",this),this.modalButton.addEventListener("click",this),this.modalClose.addEventListener("click",this)}handleEvent(e){if(this.isCLoseAction(e))return this.closeModal()}isCLoseAction(e){return console.log(e.type),e.target===this.modalButton||e.target===this.modal||e.key==="Escape"||e.target===this.modalClose}openModal(){this.modal.classList.remove("close"),this.modal.classList.add("block"),setTimeout(()=>{this.modal.classList.add("open")},100)}closeModal(){this.modal.classList.remove("open"),this.modal.classList.add("close"),setTimeout(()=>{this.modal.classList.remove("block")},500)}}class M extends F{constructor(e,t){super(),this.result=e,this.images=t,this.resolvePromise=null,this.initEvents()}initEvents(){super.initEvents()}handleEvent(e){if(e.target===this.modal||e.key==="Escape"||e.target===this.modalClose){this.closeModal(),this.resolvePromise&&this.resolvePromise(!1);return}if(e.target===this.modalButton){this.closeModal(),this.resolvePromise&&this.resolvePromise(!0);return}}loadContent(){return this.modalTitle.textContent=this.result?"Victory!":"Defeat!",this.modalContent.textContent=this.result?"Enemies fall before you!":"Even heroes stumble, but rise again",this.modalImage.src=this.result?this.images.win:this.images.lose,this.modalButton.textContent=this.result?"They won't stop me!":"One more round!",this.openModal(),new Promise(e=>{this.resolvePromise=e})}}class B extends F{constructor(e=null){super(),this.image="./images/Squiffy-ghast.webp",this.initEvents(),this.stringClose=e,this.resolvePromise=null}initEvents(){super.initEvents()}handleEvent(e){if(e.target===this.modal||e.key==="Escape"||e.target===this.modalClose){this.closeModal(),this.resolvePromise&&this.resolvePromise(!1);return}if(e.target===this.modalButton){this.closeModal(),this.resolvePromise&&this.resolvePromise(!0);return}}loadContent(){return this.modalTitle.textContent="Are you sure?",this.modalContent.textContent=this.stringClose?this.stringClose:"If you leave the fight… it will not haunt the records.",this.modalImage.src=this.image,this.modalButton.textContent="Yes… leave.",this.openModal(),new Promise(e=>{this.resolvePromise=e})}}new ee(1500);const _=[];document.querySelector(".homepage__close");const te=document.querySelector(".registration__btn"),L=document.querySelector(".registration__input"),p=document.querySelector(".registration__label");document.querySelector(".registration");const T=document.querySelector(".avatar"),E=document.querySelector(".character__wins"),A=document.querySelector(".character__loses");let l,N=null,n=null;const i="./images/",m={ROUT:"current_rout",PLAYER_PROFILE:"fight_game_player_profile",CURRENT_FIGHT:"fight_game_current_fight",SELECTED_PARTS:"fight_game_selected_parts"},H={currentPage:"",currentSubPage:""},C=[{name:"crusader",srcAvatar:`${i}crusader/Crus_camp.png`,srcBase:`${i}crusader/Crusader.webp`,srcAttack:`${i}crusader/Crus_attack.webp`,srcDef:`${i}crusader/Crus_def.webp`,win:`${i}crusader/Crus_heroic.webp`,lose:`${i}crusader/Crus_dead.webp`},{name:"grave-robber",srcAvatar:`${i}grave-robber/Grave_robber_camp.png`,srcBase:`${i}grave-robber/Graverobber_combat.webp`,srcAttack:`${i}grave-robber/Grave_robber_attack.webp`,srcDef:`${i}grave-robber/Grave_robber_defend.webp`,win:`${i}grave-robber/Grave_robber_heroic.webp`,lose:`${i}grave-robber/Grave_robber_dead.webp`},{name:"hellion",srcAvatar:`${i}hellion/Hellion_camp.png`,srcBase:`${i}hellion/Hellion_combat.webp`,srcAttack:`${i}hellion/Hellion_attack.webp`,srcDef:`${i}hellion/Hellion_defend.webp`,win:`${i}hellion/Hellion_heroic.webp`,lose:`${i}hellion/Hellion_dead.webp`},{name:"houndmaster",srcAvatar:`${i}houndmaster/Houndmaster_camp.png`,srcBase:`${i}houndmaster/Houndmaster_base.webp`,srcAttack:`${i}houndmaster/Houndmaster_attack.webp`,srcDef:`${i}houndmaster/Houndmaster_defend.webp`,win:`${i}houndmaster/Houndmaster_heroic.webp`,lose:`${i}houndmaster/Houndmaster_dead.webp`},{name:"jester",srcAvatar:`${i}jester/Jester_camp.png`,srcBase:`${i}jester/Jester_base.webp`,srcAttack:`${i}jester/Jester_attack.webp`,srcDef:`${i}jester/Jester_defend.webp`,win:`${i}jester/Jester_heroic.webp`,lose:`${i}jester/Jester_dead.webp`},{name:"flagellant",srcAvatar:`${i}flagellant/Flagellant_camp.png`,srcBase:`${i}flagellant/Flag_combat.webp`,srcAttack:`${i}flagellant/Flagellant_attack.webp`,srcDef:`${i}flagellant/Flagellant_deffer.webp`,win:`${i}flagellant/Flagellant_afflicted.webp`,lose:`${i}flagellant/Flagellant_dead.webp`}];let S;const J=document.querySelector(".hero__image--attack"),U=document.querySelector(".hero__image--def"),se=[{name:"spider",srcBase:`${i}spider/Spider.webp`,srcAttack:`${i}spider/Webber_attack.webp`,srcDef:`${i}spider/Webber_def.webp`},{name:"gargoyle",srcBase:`${i}gargoyle/Gargoyle_combat.webp`,srcAttack:`${i}gargoyle/Gargoyler_attack.webp`,srcDef:`${i}gargoyle/Gargoyle_defend.webp`},{name:"gaint",srcBase:`${i}gaint/Unclean-giant_battle.webp`,srcAttack:`${i}gaint/Unclean_giant_attack.webp`,srcDef:`${i}gaint/Unclean_giant_defend.webp`}];function W(s){const e=C.find(o=>o.name===s);if(!e)return;const t=document.querySelector(".hero__image--main img"),a=document.querySelector(".hero__image--attack img"),r=document.querySelector(".hero__image--def img");e.srcBase&&(t.src=e.srcBase),e.srcAttack&&(a.src=e.srcAttack),e.srcDef&&(r.src=e.srcDef),J.classList.add(s),U.classList.add(s)}function j(s){const e=se.find(g=>g.name===s);if(!e)return;const t=document.querySelector(".boss__image--main img"),a=document.querySelector(".boss__image--attack img"),r=document.querySelector(".boss__image--def img"),o=document.querySelector(".boss");t.src=e.srcBase,a.src=e.srcAttack,r.src=e.srcDef;const h=I.find(g=>g.name===s);let u="";if(h){switch(s){case"spider":u=`${h.displayName}: It bites not hard, but often—its fangs pierce through your armor if you linger.`;break;case"gargoyle":u=`${h.displayName}: A stony wretch, hard and cruel—you’ll chip away, praying not to die first.`;break;case"gaint":u=`${h.displayName}: It strikes with crushing force, careless of defense—you’ll need luck to survive.`;break;default:u=`${h.displayName}: Unknown enemy`}o.setAttribute("data-boss-info",u)}}class ae{constructor(){this.currentPage="registration",this.currentSubPage="main",this.init()}init(){const e=sessionStorage.getItem(m.ROUT);if(e){const a=JSON.parse(e);this.currentPage=a.currentPage,this.currentSubPage=a.currentSubPage,this.currentPage==="homepage"&&(this.showHomepage(),this.showSubPage(this.currentSubPage))}const t=sessionStorage.getItem(m.PLAYER_PROFILE);if(t){const a=JSON.parse(t);if(l=new G(a.name,a),this.currentPage==="homepage"&&(document.querySelector(".homepage__title").textContent=l.character.name,E.textContent=l.getWins(),A.textContent=l.getLoses(),l.character.imageName&&l.createAvatar(C,N,T),l.character.imageName)){const r=document.querySelector(`[name="character"][value="${l.character.imageName}"]`);r&&(r.checked=!0)}}document.addEventListener("click",a=>{if(a.target.classList.contains("homepage__main-link")){if(a.preventDefault(),this.currentSubPage==="main")return;this.showSubPage("main")}if(a.target.classList.contains("homepage__character-link")){if(a.preventDefault(),this.currentSubPage==="character")return;if(n){console.log(n),new B().loadContent().then(o=>{o&&(n=null,$(),E.textContent=l.getWins(),A.textContent=l.getLoses(),this.showSubPage("character"))});return}E.textContent=l.getWins(),A.textContent=l.getLoses(),this.showSubPage("character")}if(a.target.classList.contains("homepage__settings-link")){if(a.preventDefault(),this.currentSubPage==="settings")return;if(n){console.log(n),new B().loadContent().then(o=>{o&&(n=null,$(),E.textContent=l.getWins(),A.textContent=l.getLoses(),this.showSubPage("settings"))});return}this.showSubPage("settings")}if(a.target.classList.contains("homepage__close")){new B("If you leave… your progress will be devoured.").loadContent().then(o=>{o&&(sessionStorage.clear(),this.showRegistration(),_.pop(),T.innerHTML="",document.querySelectorAll('[name="character"]').forEach(h=>{h.checked=!1}),N=null,_.length=0,l=null,$())});return}})}showRegistration(){document.querySelector(".homepage").classList.add("off"),document.querySelector(".homepage").classList.remove("on"),this.hideAllSubPages(),this.removeActiveLinks(),setTimeout(()=>{document.querySelector(".registration").classList.remove("off"),document.querySelector(".registration").classList.add("on")},500),this.currentPage="registration"}showHomepage(){this.hideRegistrPages(),document.querySelector(".homepage").classList.add("on"),document.querySelector(".homepage").classList.remove("off"),this.showSubPage("main"),this.currentPage="homepage"}showSubPage(e){this.hideAllSubPages(),this.removeActiveLinks(),setTimeout(()=>{document.querySelector(`.homepage__${e}`).classList.remove("none")},500),setTimeout(()=>{document.querySelector(`.homepage__${e}`).classList.add("on"),document.querySelector(`.homepage__${e}-link`).classList.add("active"),this.currentSubPage=e,H.currentPage=this.currentPage,H.currentSubPage=this.currentSubPage,sessionStorage.setItem(m.ROUT,JSON.stringify(H))},100)}hideRegistrPages(){document.querySelector(".registration").classList.add("off"),document.querySelector(".registration").classList.remove("on")}hideAllSubPages(){document.querySelectorAll(".homepage__main, .homepage__character, .homepage__settings").forEach(e=>{e.classList.remove("on"),e.classList.add("off"),setTimeout(()=>{e.classList.add("none")},500)})}removeActiveLinks(){document.querySelectorAll(".homepage__menu a").forEach(e=>{e.classList.remove("active")})}}const D=new ae;let d;L.addEventListener("input",s=>{d=!1,Y(s.target.value,p)});L.addEventListener("keydown",s=>{s.key==="Enter"&&(d&&V(L.value),d||(p.classList.add("error"),setTimeout(()=>{p.classList.remove("error")},300)),d=!1)});te.addEventListener("click",()=>{d&&(V(L.value),L.value=""),d||(p.classList.add("error"),setTimeout(()=>{p.classList.remove("error")},300))});function Y(s,e){const t=/^[a-zA-Z]+$/,a=s.trim();if(a.length===0){e.style.setProperty("--hint-text",'"English only"'),d=!1;return}if(!t.test(a)){e.style.setProperty("--hint-text",'"English only"'),d=!1;return}if(a.length<3){e.style.setProperty("--hint-text",'"Min 3 chars"'),d=!1;return}e.style.setProperty("--hint-text",'""'),d=!0}function V(s){if(_.filter(t=>t.character.name===s).length!==0){p.style.setProperty("--hint-text",'"Name not available"'),p.classList.add("error"),setTimeout(()=>{p.classList.remove("error")},300);return}_.push(new G(L.value)),l=_.find(t=>t.character.name===s),D.hideRegistrPages(),sessionStorage.setItem(m.PLAYER_PROFILE,JSON.stringify(l.character)),console.log(l.character,_),setTimeout(()=>{D.showHomepage(),document.querySelector(".homepage__title").textContent=l.character.name},500)}const re=document.querySelector(".character__btn"),oe=document.querySelectorAll('[name="character"]'),f=document.querySelector(".homepage__btn-fight"),b=document.querySelector(".battle-wrapper"),k=document.querySelector(".battle-wrapper__start-fight");let w=!1;oe.forEach(s=>{s.addEventListener("change",e=>{l.setImageName(e.target.value)})});re.addEventListener("click",()=>{l.createAvatar(C,N,T),f.classList.remove("inactive"),sessionStorage.setItem(m.PLAYER_PROFILE,JSON.stringify(l.character))});const v=document.querySelector(".settings__input"),ie=document.querySelector(".settings__btn"),ne=document.querySelector(".settings__label");v.addEventListener("input",s=>{d=!1,Y(s.target.value,ne)});ie.addEventListener("click",()=>{d&&(l.character.name=v.value,document.querySelector(".homepage__title").textContent=l.character.name,v.value="",sessionStorage.setItem(m.PLAYER_PROFILE,JSON.stringify(l.character))),d||(p.classList.add("error"),setTimeout(()=>{p.classList.remove("error")},300)),d=!1});v.addEventListener("keydown",s=>{s.key==="Enter"&&d&&(l.character.name=v.value,document.querySelector(".homepage__title").textContent=l.character.name,v.value="",d=!1,sessionStorage.setItem(m.PLAYER_PROFILE,JSON.stringify(l.character)))});const P=document.querySelectorAll(".block"),q=document.querySelectorAll(".attack"),y=Array.from(P).map(s=>s.value),c={blockParts:[],attackParts:[]};function R(){sessionStorage.setItem(m.SELECTED_PARTS,JSON.stringify(c))}function le(){const s=sessionStorage.getItem(m.SELECTED_PARTS);if(console.log(s),s)try{const e=JSON.parse(s);c.blockParts=e.blockParts||[],c.attackParts=e.attackParts||[],ce()}catch(e){console.error("Ошибка при загрузке выбранных зон:",e),sessionStorage.removeItem(m.SELECTED_PARTS)}}function ce(){P.forEach(s=>{console.log(c.blockParts,c.blockParts.includes(s.value)),s.checked=c.blockParts.includes(s.value)}),q.forEach(s=>{console.log(c.attackParts,c.attackParts.includes(s.value)),s.checked=c.attackParts.includes(s.value)}),O(P,2,c.blockParts),O(q,1,c.attackParts),x()}function O(s,e,t){t.length===e?s.forEach(a=>{a.checked||(a.disabled=!0,a.parentElement.classList.add("disabled"))}):s.forEach(a=>{a.disabled=!1,a.parentElement.classList.remove("disabled")}),x()}function Z(s,e,t){s.forEach(a=>{a.addEventListener("change",()=>{t.length=0,t.push(...Array.from(s).filter(r=>r.checked).map(r=>r.value)),t.length===e?s.forEach(r=>{r.checked||(r.disabled=!0,r.parentElement.classList.add("disabled"))}):s.forEach(r=>{r.disabled=!1,r.parentElement.classList.remove("disabled")}),R(),x()})})}function x(){const s=c.attackParts.length===1,e=c.blockParts.length===2;s&&e?(w=!0,k.classList.remove("inactive")):(w=!1,k.classList.add("inactive"))}const he=document.querySelector(".boss__image--attack"),de=document.querySelector(".boss__image--def"),me=document.querySelector(".hero__image--attack"),ue=document.querySelector(".hero__image--def"),I=[{name:"spider",displayName:"Spider",hp:315,damage:16,critChance:.33,critMultiplier:2,attackZones:2,blockZones:1},{name:"gargoyle",displayName:"Gargoyle",hp:375,damage:22,critChance:.2,critMultiplier:1.5,attackZones:1,blockZones:3},{name:"gaint",displayName:"Giant",hp:450,damage:47,critChance:.15,critMultiplier:2,attackZones:1,blockZones:1}];function ge(){const s=Math.floor(Math.random()*I.length);return I[s]}class z{constructor(e){this.name=e,this.maxHp=350,this.hp=350,this.damage=35,this.critChance=.22,this.critMultiplier=1.7}takeDamage(e){this.hp=Math.max(0,this.hp-e)}getHpPercentage(){return Math.floor(this.hp/this.maxHp*100)}isAlive(){return this.hp>0}}class K{constructor(e){this.name=e.displayName,this.hp=e.hp,this.maxHp=e.hp,this.damage=e.damage,this.critChance=e.critChance,this.critMultiplier=e.critMultiplier,this.attackZones=e.attackZones,this.blockZones=e.blockZones}isAlive(){return this.hp>0}takeDamage(e){this.hp=Math.max(0,this.hp-e)}getHpPercentage(){return Math.floor(this.hp/this.maxHp*100)}generateAttackZones(){return this.shuffleZones(this.attackZones)}generateBlockZones(){return this.shuffleZones(this.blockZones)}shuffleZones(e){const t=[...y];for(let r=t.length-1;r>0;r--){const o=Math.floor(Math.random()*(r+1));[t[r],t[o]]=[t[o],t[r]]}const a=t.slice(0,e);if(e>1){for(let r=1;r<a.length;r++)if(a[r]===a[r-1]){let o=y.indexOf(a[r]);o===y.length-1?o=0:o+=1,a[r]=y[o],a[r]===a[r-1]&&(o=o===0?y.length-1:o-1,a[r]=y[o])}}return a}}class pe{constructor(){this.logs=[],this.logContainer=document.querySelector(".logs-battle__list")}addHit(e,t,a,r){const o=`⚔️ <span class="log-variable">${e}</span> hits <span class="log-variable">${t}</span> in the <span class="log-variable">${a}</span> for <span class="log-variable">${r}</span> damage.`;this.addLog(o)}addBlock(e,t,a,r){const o=`🛡️ <span class="log-variable">${e}</span> blocks <span class="log-variable">${r}</span> damage to the <span class="log-variable">${a}</span> from <span class="log-variable">${t}</span>.`;this.addLog(o)}addCriticalHit(e,t,a,r,o=!1){const u=`💥 <span class="log-variable">${e}</span> lands a critical hit on <span class="log-variable">${t}</span>'s <span class="log-variable">${a}</span>, dealing <span class="log-variable">${r}</span> damage <span class="log-variable">${o?" (piercing the block)":""}</span>.`;this.addLog(u)}addRoundStart(e){const t=`🔥 Round ${e} begins!`;this.addLog(t)}addBattleStart(e,t){const a=`⚔️ Battle started! <span class="log-variable">${e}</span> vs <span class="log-variable">${t}</span>`;this.addLog(a)}addVictory(e){const t=`🏆 <span class="log-variable">${e}</span> wins the battle!`;this.addLog(t)}addDefeat(e){const t=`💀 <span class="log-variable">${e}</span> has been defeated!`;this.addLog(t)}addLog(e){this.logs.push({message:e,timestamp:Date.now()}),this.displayLog(e)}displayLog(e){const t=document.createElement("li");t.className="logs-battle__log";const a=document.createElement("span");a.className="logs-battle__log-basis",a.innerHTML=e,t.appendChild(a),this.logContainer.appendChild(t),this.logContainer.scrollTop=this.logContainer.scrollHeight}clear(){this.logs=[],this.logContainer.innerHTML=""}}class Q{constructor(e,t,a,r){this.hero=e,this.boss=r,this.battleLog=new pe,this.round=1,this.isGameOver=!1,this.playerAttackZone=t,this.playerBlockZones=a,this.initUI()}initUI(){this.updateHpBars(),this.battleLog.clear(),this.battleLog.addBattleStart(this.hero.name,this.boss.name)}async processTurn(){if(this.isGameOver)return;this.battleLog.addRoundStart(this.round);const e=this.boss.generateAttackZones(),t=this.boss.generateBlockZones();this.hero.isAlive()&&await this.processPlayerAttacks(t),this.boss.isAlive()&&await this.processBossAttacks(e),!this.hero.isAlive()||!this.boss.isAlive()?this.endBattle():(this.round++,this.clearSelections(),X())}async processPlayerAttacks(e){for(const t of this.playerAttackZone)this.boss.isAlive()&&(this.processAttack(this.hero,this.boss,t,e),this.updateHpBars(),await this.playAnimation([me,de],1600))}async processBossAttacks(e){for(const t of e)if(this.hero.isAlive()&&(this.processAttack(this.boss,this.hero,t,this.playerBlockZones),this.updateHpBars(),await this.playAnimation([he,ue],1600),!this.hero.isAlive())){this.endBattle();return}}playAnimation(e,t){return new Promise(a=>{e.forEach(r=>r.classList.add("active")),setTimeout(()=>{e.forEach(r=>r.classList.remove("active")),a()},t)})}processAttack(e,t,a,r){const o=Math.random()<e.critChance,h=r.includes(a);let u=e.damage,g=0;o?(u=Math.floor(u*e.critMultiplier),h?(g=u,t.takeDamage(g),this.battleLog.addCriticalHit(e.name,t.name,a,g,!0)):(g=u,t.takeDamage(g),this.battleLog.addCriticalHit(e.name,t.name,a,g))):h?this.battleLog.addBlock(t.name,e.name,a,u):(g=u,t.takeDamage(g),this.battleLog.addHit(e.name,t.name,a,g))}updateHpBars(){const e=document.querySelector(".hero__hp"),t=document.querySelector(".boss__hp"),a=document.querySelector(".hp-text-hero"),r=document.querySelector(".hp-text-boss"),o=this.hero.getHpPercentage(),h=this.boss.getHpPercentage();e.style.setProperty("--hp",`${o}%`),t.style.setProperty("--hp",`${h}%`),a.textContent=`${this.hero.hp}/${this.hero.maxHp}`,r.textContent=`${this.boss.hp}/${this.boss.maxHp}`}clearSelections(){document.querySelectorAll(".attack, .block").forEach(e=>{e.checked=!1,e.disabled=!1}),c.attackParts.length=0,c.blockParts.length=0,R()}async endBattle(){this.isGameOver=!0;let e,t;document.querySelector(".character__wins").textContent=l.character.wins.total,document.querySelector(".character__loses").textContent=l.character.loses.total,this.clearSelections(),$(),n=null,ve(),this.hero.isAlive()?this.boss.isAlive()||(this.battleLog.addVictory(this.hero.name),l.character.wins.total++,e=new M(!0,S),t=await e.loadContent()):(this.battleLog.addDefeat(this.hero.name),l.character.loses.total++,e=new M(!1,S),t=await e.loadContent()),t&&f.click()}}window.addEventListener("DOMContentLoaded",()=>{console.log(c),le(),console.log(c),Z(P,2,c.blockParts),Z(q,1,c.attackParts),sessionStorage.getItem(m.CURRENT_FIGHT)&&be()});f.addEventListener("click",()=>{if(!l.character.imageName){f.classList.add("inactive");return}S=C.find(a=>a.name===l.character.imageName),W(l.character.imageName);const s=ge();j(s.name);const e=new K(s),t=new z(l.character.name);n=new Q(t,c.attackParts,c.blockParts,e),f.classList.add("off"),b.classList.remove("none"),setTimeout(()=>{b.classList.add("on")},100),X()});k.addEventListener("click",()=>{w&&n&&(w=!1,n.playerAttackZone=[...c.attackParts],n.playerBlockZones=[...c.blockParts],n.processTurn()),k.classList.add("inactive")});function $(){J.classList.remove(S.name),U.classList.remove(S.name),f.classList.remove("inactive"),f.classList.remove("off"),b.classList.add("off"),setTimeout(()=>{b.classList.add("none")},500),b.classList.remove("on"),c.attackParts.length=0,c.blockParts.length=0,R(),q.forEach(s=>{s.checked=!1,s.disabled=!1,s.parentElement.classList.remove("disabled")}),P.forEach(s=>{s.checked=!1,s.disabled=!1,s.parentElement.classList.remove("disabled")}),w=!1,k.classList.add("inactive"),sessionStorage.removeItem(m.CURRENT_FIGHT),n=null}function X(){if(n){const s={hero:{name:n.hero.name,hp:n.hero.hp,maxHp:n.hero.maxHp,damage:n.hero.damage,critChance:n.hero.critChance,critMultiplier:n.hero.critMultiplier},boss:{name:n.boss.name,hp:n.boss.hp,maxHp:n.boss.maxHp,damage:n.boss.damage,critChance:n.boss.critChance,critMultiplier:n.boss.critMultiplier,attackZones:n.boss.attackZones,blockZones:n.boss.blockZones},round:n.round,isGameOver:n.isGameOver,playerAttackZone:n.playerAttackZone,playerBlockZones:n.playerBlockZones,battleLogs:n.battleLog.logs,heroImageName:l.character.imageName,bossConfig:fe(n.boss.name)};sessionStorage.setItem(m.CURRENT_FIGHT,JSON.stringify(s))}}function fe(s){return I.find(e=>e.displayName===s)}function be(){const s=sessionStorage.getItem(m.CURRENT_FIGHT);if(s)try{const e=JSON.parse(s);W(e.heroImageName),j(e.bossConfig.name),S=C.find(r=>r.name===e.heroImageName);const t=new z(e.hero.name);t.hp=e.hero.hp,t.maxHp=e.hero.maxHp,t.damage=e.hero.damage,t.critChance=e.hero.critChance,t.critMultiplier=e.hero.critMultiplier;const a=new K(e.bossConfig);a.hp=e.boss.hp,a.maxHp=e.boss.maxHp,n=new Q(t,e.playerAttackZone,e.playerBlockZones,a),n.round=e.round,n.isGameOver=e.isGameOver,n.battleLog.logs=e.battleLogs||[],ye(e.battleLogs),_e(),console.log("Битва восстановлена!")}catch(e){console.error("Ошибка при восстановлении битвы:",e),sessionStorage.removeItem(m.CURRENT_FIGHT)}}function ye(s){if(s&&s.length>0){const e=document.querySelector(".logs-battle__list");e.innerHTML="",s.forEach(t=>{n.battleLog.displayLog(t.message)})}}function _e(){f.classList.add("off"),b.classList.remove("none"),b.classList.add("on")}function ve(){sessionStorage.removeItem(m.CURRENT_FIGHT)}
